<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
	<title>Game with Debug Logger</title>
	<script>
		// ç«‹å³å¼€å§‹æ—¥å¿—è½¬å‘è®¾ç½®ï¼Œç¡®ä¿æ•è·æ‰€æœ‰æ—¥å¿—
		(function() {
			const originalConsole = {
				log: console.log,
				error: console.error,
				warn: console.warn,
				info: console.info,
				debug: console.debug
			};

			function sendLogToMiniProgram(logEntry) {
				if (typeof wx !== 'undefined' && wx.miniProgram) {
					wx.miniProgram.postMessage({
						data: logEntry
					});
				}
			}

			// é‡å†™consoleæ–¹æ³•
			['log', 'error', 'warn', 'info', 'debug'].forEach(method => {
				console[method] = function(...args) {
					originalConsole[method].apply(console, args);
					
					const logEntry = {
						type: 'webview_log',
						level: method,
						message: args.map(arg => 
							typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
						).join(' '),
						timestamp: new Date().toISOString(),
						url: window.location.href
					};
					
					sendLogToMiniProgram(logEntry);
				};
			});

			// æ‹¦æˆªé”™è¯¯
			window.addEventListener('error', function(event) {
				const errorLog = {
					type: 'webview_log',
					level: 'error',
					message: `JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`,
					timestamp: new Date().toISOString(),
					url: window.location.href,
					stack: event.error ? event.error.stack : 'No stack trace available'
				};
				sendLogToMiniProgram(errorLog);
			});

			console.log('ğŸ”§ Debug logger initialized');
		})();
	</script>
</head>
<body>
	<div style="padding: 20px; font-family: Arial, sans-serif;">
		<h1>ğŸ® æ¸¸æˆè°ƒè¯•é¡µé¢</h1>
		<p>è¿™ä¸ªé¡µé¢ä¼šå°†æ‰€æœ‰æ—¥å¿—è½¬å‘åˆ°å°ç¨‹åºæ§åˆ¶å°</p>
		
		<button onclick="testLogs()" style="padding: 10px 20px; margin: 10px; background: #007aff; color: white; border: none; border-radius: 5px;">
			ç”Ÿæˆæµ‹è¯•æ—¥å¿—
		</button>
		
		<button onclick="window.location.href='https://jiepengtan.github.io/miniprogram-web-game'" style="padding: 10px 20px; margin: 10px; background: #28a745; color: white; border: none; border-radius: 5px;">
			è·³è½¬åˆ°å®é™…æ¸¸æˆ
		</button>
		
		<div id="logs" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; font-size: 14px;"></div>
	</div>

	<script>
		const logsDiv = document.getElementById('logs');
		
		function addLogToPage(level, message) {
			const logElement = document.createElement('div');
			logElement.style.marginBottom = '5px';
			logElement.style.color = getLogColor(level);
			logElement.innerHTML = `[${new Date().toLocaleTimeString()}] [${level.toUpperCase()}] ${message}`;
			logsDiv.appendChild(logElement);
			logsDiv.scrollTop = logsDiv.scrollHeight;
		}
		
		function getLogColor(level) {
			switch(level) {
				case 'error': return '#dc3545';
				case 'warn': return '#ffc107';
				case 'info': return '#17a2b8';
				case 'debug': return '#6c757d';
				default: return '#28a745';
			}
		}

		function testLogs() {
			console.log('ğŸ® å¼€å§‹æµ‹è¯•æ—¥å¿—åŠŸèƒ½');
			addLogToPage('log', 'ğŸ® å¼€å§‹æµ‹è¯•æ—¥å¿—åŠŸèƒ½');
			
			setTimeout(() => {
				console.info('â„¹ï¸ è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æ—¥å¿—');
				addLogToPage('info', 'â„¹ï¸ è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æ—¥å¿—');
			}, 500);
			
			setTimeout(() => {
				console.warn('âš ï¸ è¿™æ˜¯ä¸€æ¡è­¦å‘Šæ—¥å¿—');
				addLogToPage('warn', 'âš ï¸ è¿™æ˜¯ä¸€æ¡è­¦å‘Šæ—¥å¿—');
			}, 1000);
			
			setTimeout(() => {
				console.error('âŒ è¿™æ˜¯ä¸€æ¡é”™è¯¯æ—¥å¿—');
				addLogToPage('error', 'âŒ è¿™æ˜¯ä¸€æ¡é”™è¯¯æ—¥å¿—');
			}, 1500);
			
			setTimeout(() => {
				console.debug('ğŸ”§ è¿™æ˜¯ä¸€æ¡è°ƒè¯•æ—¥å¿—');
				addLogToPage('debug', 'ğŸ”§ è¿™æ˜¯ä¸€æ¡è°ƒè¯•æ—¥å¿—');
			}, 2000);
			
			setTimeout(() => {
				console.log('å¤æ‚å¯¹è±¡:', {
					user: 'test_user',
					score: 1000,
					items: ['sword', 'shield', 'potion']
				});
				addLogToPage('log', 'å¤æ‚å¯¹è±¡å·²å‘é€åˆ°å°ç¨‹åº');
			}, 2500);
		}

		// é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡æµ‹è¯•
		window.addEventListener('load', function() {
			console.log('ğŸ“± è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
			addLogToPage('log', 'ğŸ“± è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
			
			// è·å–URLå‚æ•°
			const urlParams = new URLSearchParams(window.location.search);
			const params = {
				userId: urlParams.get('userId') || 'default_user',
				mode: urlParams.get('mode') || 'normal',
				level: parseInt(urlParams.get('level')) || 1,
				debug: urlParams.get('debug') || 'false'
			};
			
			console.log('ğŸ“Š æ¥æ”¶åˆ°çš„å‚æ•°:', params);
			addLogToPage('log', `ğŸ“Š æ¥æ”¶åˆ°çš„å‚æ•°: ${JSON.stringify(params)}`);
			
			// è‡ªåŠ¨ç”Ÿæˆä¸€æ¬¡æµ‹è¯•æ—¥å¿—
			setTimeout(testLogs, 1000);
		});
	</script>
</body>
</html> 